# Development Dockerfile for Next.js application
FROM node:20-alpine

RUN apk add --no-cache libc6-compat python3 make g++

# Enable Corepack for Yarn 3.2.3
RUN corepack enable

WORKDIR /app

# Copy entire scaffold directory (including .yarn for Yarn 3.2.3)
# Excluding node_modules and cache via .dockerignore
COPY scaffold ./scaffold

# Install dependencies
WORKDIR /app/scaffold
ENV YARN_ENABLE_IMMUTABLE_INSTALLS=false
RUN yarn install

WORKDIR /app/scaffold/packages/nextjs

EXPOSE 3000

ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

CMD ["yarn", "dev"]

